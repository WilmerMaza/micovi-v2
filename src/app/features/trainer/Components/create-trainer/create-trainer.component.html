<div class="create-trainer-container">
  @if (showViewTrainer) {
    <mat-card class="trainer-card">
      <!-- Header with back button and title -->
      <div class="header">
        <button mat-icon-button class="back-button" (click)="closeCard()">
          <mat-icon>arrow_back</mat-icon>
        </button>
        <div class="header-content">
          <h2>Añadir nuevo entrenador</h2>
          <p>Complete la información del entrenador</p>
        </div>
      </div>

      <!-- Main form content -->
      <div class="form-container">
        <form [formGroup]="trainerForm" class="trainer-form">

          <!-- Top section with photo and basic info -->
          <div class="top-section">
            <!-- Photo upload section -->
            <div class="photo-section">
              <div class="photo-upload">
                <input
                  type="file"
                  id="upload"
                  accept=".png, .jpg, .webp"
                  (change)="onFilesSelected($event)"
                  hidden
                />
                @if (!selectedImageURL) {
                  <label for="upload" class="upload-label">
                    <mat-icon class="upload-icon">add</mat-icon>
                    <span class="upload-text">Subir foto</span>
                  </label>
                } @else {
                  <label for="upload" class="upload-label">
                    <img [src]="selectedImageURL" alt="Foto del entrenador" class="uploaded-image" />
                  </label>
                }
              </div>
              <p class="photo-label">Foto del entrenador</p>
            </div>

            <!-- Basic info fields -->
            <div class="basic-info">
              <div class="field-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Nombre completo</mat-label>
                  <input matInput
                         formControlName="name"
                         placeholder="Ingrese el nombre completo">
                  @if (trainerForm.get('name')?.hasError('required')) {
                    <mat-error>Campo requerido</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Tipo de documento</mat-label>
                  <mat-select formControlName="typeIdentification" placeholder="Seleccionar">
                    @for (option of typeIdentificationList; track option.code) {
                      <mat-option [value]="option.code">
                        {{ option.code + " - " + option.value }}
                      </mat-option>
                    }
                  </mat-select>
                  @if (trainerForm.get('typeIdentification')?.hasError('required')) {
                    <mat-error>Campo requerido</mat-error>
                  }
                </mat-form-field>
              </div>

              <div class="field-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Número de documento</mat-label>
                  <input matInput
                         formControlName="identification"
                         placeholder="Ingrese el número">
                  @if (trainerForm.get('identification')?.hasError('required')) {
                    <mat-error>Campo requerido</mat-error>
                  }
                  @if (trainerForm.get('identification')?.hasError('pattern')) {
                    <mat-error>Campo inválido</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Fecha de nacimiento</mat-label>
                  <input matInput
                         [matDatepicker]="picker"
                         formControlName="birtDate"
                         placeholder="dd/mm/aaaa">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                  @if (trainerForm.get('birtDate')?.hasError('required')) {
                    <mat-error>Campo requerido</mat-error>
                  }
                </mat-form-field>
              </div>
            </div>
          </div>

          <!-- Personal information section -->
          <div class="section">
            <div class="section-header">
              <mat-icon class="section-icon">person</mat-icon>
              <h3>Información personal</h3>
            </div>

            <div class="field-row three-columns">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>País de nacimiento</mat-label>
                <mat-select formControlName="nationality"
                           placeholder="Seleccionar"
                           (selectionChange)="universalEstadoApis($event)">
                  @for (country of listPaises; track country.country_name) {
                    <mat-option [value]="country.country_name">
                      {{ country.country_name }}
                    </mat-option>
                  }
                </mat-select>
                @if (trainerForm.get('nationality')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Departamento de nacimiento</mat-label>
                <mat-select formControlName="stateordepartmen"
                           placeholder="Seleccionar"
                           [disabled]="!activeDepto"
                           (selectionChange)="universalCiudadesApis($event)">
                  @for (state of listEstados; track state.state_name) {
                    <mat-option [value]="state.state_name">
                      {{ state.state_name }}
                    </mat-option>
                  }
                </mat-select>
                @if (trainerForm.get('stateordepartmen')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Ciudad de nacimiento</mat-label>
                <mat-select formControlName="city"
                           placeholder="Seleccionar"
                           [disabled]="!activeCity">
                  @for (city of listCiudades; track city.city_name) {
                    <mat-option [value]="city.city_name">
                      {{ city.city_name }}
                    </mat-option>
                  }
                </mat-select>
                @if (trainerForm.get('city')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
              </mat-form-field>
            </div>

            <div class="field-row three-columns">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Género</mat-label>
                <mat-select formControlName="gender" placeholder="Seleccionar">
                  @for (gender of genderList; track gender.code) {
                    <mat-option [value]="gender.code">
                      {{ gender.value }}
                    </mat-option>
                  }
                </mat-select>
                @if (trainerForm.get('gender')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Teléfono</mat-label>
                <input matInput
                       formControlName="phone"
                       placeholder="Ingrese el teléfono">
                @if (trainerForm.get('phone')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
                @if (hasErrorRegexp('phone')) {
                  <mat-error>El formato del teléfono no es válido</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Máximo nivel de estudio alcanzado</mat-label>
                <mat-select formControlName="studyLevelMax" placeholder="Seleccionar">
                  @for (level of trainerNivel; track level.code) {
                    <mat-option [value]="level.code">
                      {{ level.value }}
                    </mat-option>
                  }
                </mat-select>
                @if (trainerForm.get('studyLevelMax')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
              </mat-form-field>
            </div>

            <div class="field-row single-column">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Institución donde estudió</mat-label>
                <input matInput
                       formControlName="institutionNameStudy"
                       placeholder="Nombre de la institución">
                @if (trainerForm.get('institutionNameStudy')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
                @if (trainerForm.get('institutionNameStudy')?.hasError('pattern')) {
                  <mat-error>Campo inválido</mat-error>
                }
              </mat-form-field>
            </div>
          </div>

          <!-- Contact information section -->
          <div class="section">
            <div class="section-header">
              <h3>Información de contacto</h3>
            </div>

            <div class="field-row three-columns">
              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Correo electrónico</mat-label>
                <input matInput
                       formControlName="email"
                       type="email"
                       placeholder="correo@ejemplo.com">
                @if (trainerForm.get('email')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
                @if (trainerForm.get('email')?.hasError('pattern')) {
                  <mat-error>Campo inválido</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Contraseña</mat-label>
                <input matInput
                       formControlName="password"
                       type="password"
                       placeholder="Ingrese la contraseña">
                @if (trainerForm.get('password')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
                @if (trainerForm.get('password')?.hasError('pattern')) {
                  <mat-error>Mínimo 8 caracteres, con combinación de mayúsculas, minúsculas, números y símbolos</mat-error>
                }
              </mat-form-field>

              <mat-form-field appearance="outline" class="form-field">
                <mat-label>Confirmar contraseña</mat-label>
                <input matInput
                       formControlName="passwordVerificate"
                       type="password"
                       placeholder="Confirme la contraseña"
                       (input)="validatePassword()">
                @if (trainerForm.get('passwordVerificate')?.hasError('required')) {
                  <mat-error>Campo requerido</mat-error>
                }
                @if (trainerForm.get('passwordVerificate')?.hasError('pattern')) {
                  <mat-error>Mínimo 8 caracteres, con combinación de mayúsculas, minúsculas, números y símbolos</mat-error>
                }
                @if (trainerForm.get('passwordVerificate')?.hasError('passwordMismatch')) {
                  <mat-error>Las contraseñas no coinciden</mat-error>
                }
              </mat-form-field>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="actions">
            <button mat-button
                    type="button"
                    class="cancel-btn"
                    (click)="closeCard()">
              Cancelar
            </button>
            <button mat-raised-button
                    color="primary"
                    type="submit"
                    class="submit-btn"
                    (click)="createTrainer()"
                    [disabled]="!isFormValidForSubmission">
              Crear entrenador
            </button>
          </div>
        </form>
      </div>
    </mat-card>
  }
</div>
